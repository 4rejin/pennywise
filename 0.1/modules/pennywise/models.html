
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Pennywise Documentation</title>
    <link rel="stylesheet" href="../../static/main.css" type="text/css">
    <link rel="stylesheet" href="../../static/docstyles.css" type="text/css">
    <link rel="stylesheet" href="../../_static/print.css" type="text/css" media="print">
    <link rel="stylesheet" href="../../static/pygments.css" type="text/css">
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:   '../../',
        VERSION:    '0.1'
      };
    </script>
    <script type="text/javascript" src="../../static/jquery.js"></script>
    <script type="text/javascript" src="../../static/searchtools.js"></script>
    <script type="text/javascript" src="../../static/doctools.js"></script>
    <link rel="contents" title="Global table of contents" href="../../contents.html">
    <link rel="index" title="Global index" href="../../genindex.html">
    <link rel="search" title="Search" href="../../search.html">
    <link rel="top" title="Pennywise v0.1 documentation" href="../../index.html">
    <link rel="up" title="Module code" href="../index.html">
    
  </head>
  <body>
    <div id="body">
      <div id="header">
        <h1 id="logo"><a href="../../index.html"
          title="back to the documentation overview"><img src="../../static/logo.png" alt="Pennywise" /></a></h1>
        <ul id="menu">
          <li><a href="http://jace.github.com/pennywise">Website</li>
          <li><a href="../../index.html">Documentation</a></li>
          <li><a href="../../faq.html">FAQ</a></li>
          <li><a href="http://github.com/jace/pennywise">Code</a></li>
        </ul>
      </div>
      <div id="content">
        
  <h1>Source code for pennywise.models</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c"># Copyright (C) 2010, Kiran Jonnalagadda. All rights reserved.</span>

<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">ForeignKey</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">String</span><span class="p">,</span> <span class="n">Unicode</span><span class="p">,</span> <span class="n">UnicodeText</span><span class="p">,</span> <span class="n">Integer</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Boolean</span><span class="p">,</span> <span class="n">SmallInteger</span><span class="p">,</span> <span class="n">Numeric</span><span class="p">,</span> <span class="n">DateTime</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.exc</span> <span class="kn">import</span> <span class="n">IntegrityError</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm.exc</span> <span class="kn">import</span> <span class="n">NoResultFound</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">relation</span><span class="p">,</span> <span class="n">backref</span><span class="p">,</span> <span class="n">scoped_session</span><span class="p">,</span> <span class="n">sessionmaker</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Query</span>

<span class="n">DBSession</span> <span class="o">=</span> <span class="n">scoped_session</span><span class="p">(</span><span class="n">sessionmaker</span><span class="p">())</span>
<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="c"># ----------------------------------------------------------------------------</span>
<span class="c"># Constants</span>

<span class="k">class</span> <span class="nc">LEDGER_TYPE</span><span class="p">:</span>
    <span class="n">USER</span> <span class="o">=</span> <span class="mf">0</span>
    <span class="n">ASSET</span> <span class="o">=</span> <span class="mf">1</span>
    <span class="n">LIABILITY</span> <span class="o">=</span> <span class="mf">2</span>
    <span class="n">INCOME</span> <span class="o">=</span> <span class="mf">3</span>
    <span class="n">EXPENSE</span> <span class="o">=</span> <span class="mf">4</span>
    <span class="n">EQUITY</span> <span class="o">=</span> <span class="mf">5</span>

<span class="k">class</span> <span class="nc">LEDGER_SUBTYPE</span><span class="p">:</span>
    <span class="n">NA</span> <span class="o">=</span> <span class="mf">0</span>
    <span class="n">BANK</span> <span class="o">=</span> <span class="mf">1</span>
    <span class="n">CASH</span> <span class="o">=</span> <span class="mf">2</span>
    <span class="n">CREDITCARD</span> <span class="o">=</span> <span class="mf">3</span>
    <span class="n">ACC_RECEIVABLE</span> <span class="o">=</span> <span class="mf">4</span>
    <span class="n">ACC_PAYABLE</span> <span class="o">=</span> <span class="mf">5</span>

<span class="n">LEDGER_TYPE_COMBOS</span> <span class="o">=</span> <span class="n">set</span><span class="p">([</span>
    <span class="p">(</span><span class="n">LEDGER_TYPE</span><span class="o">.</span><span class="n">USER</span><span class="p">,</span> <span class="n">LEDGER_SUBTYPE</span><span class="o">.</span><span class="n">NA</span><span class="p">),</span>
    <span class="p">(</span><span class="n">LEDGER_TYPE</span><span class="o">.</span><span class="n">ASSET</span><span class="p">,</span> <span class="n">LEDGER_SUBTYPE</span><span class="o">.</span><span class="n">NA</span><span class="p">),</span>
    <span class="p">(</span><span class="n">LEDGER_TYPE</span><span class="o">.</span><span class="n">ASSET</span><span class="p">,</span> <span class="n">LEDGER_SUBTYPE</span><span class="o">.</span><span class="n">BANK</span><span class="p">),</span>
    <span class="p">(</span><span class="n">LEDGER_TYPE</span><span class="o">.</span><span class="n">ASSET</span><span class="p">,</span> <span class="n">LEDGER_SUBTYPE</span><span class="o">.</span><span class="n">CASH</span><span class="p">),</span>
    <span class="p">(</span><span class="n">LEDGER_TYPE</span><span class="o">.</span><span class="n">LIABILITY</span><span class="p">,</span> <span class="n">LEDGER_SUBTYPE</span><span class="o">.</span><span class="n">NA</span><span class="p">),</span>
    <span class="p">(</span><span class="n">LEDGER_TYPE</span><span class="o">.</span><span class="n">LIABILITY</span><span class="p">,</span> <span class="n">LEDGER_SUBTYPE</span><span class="o">.</span><span class="n">CREDITCARD</span><span class="p">),</span>
    <span class="p">(</span><span class="n">LEDGER_TYPE</span><span class="o">.</span><span class="n">LIABILITY</span><span class="p">,</span> <span class="n">LEDGER_SUBTYPE</span><span class="o">.</span><span class="n">ACC_PAYABLE</span><span class="p">),</span>
    <span class="p">(</span><span class="n">LEDGER_TYPE</span><span class="o">.</span><span class="n">INCOME</span><span class="p">,</span> <span class="n">LEDGER_SUBTYPE</span><span class="o">.</span><span class="n">NA</span><span class="p">),</span>
    <span class="p">(</span><span class="n">LEDGER_TYPE</span><span class="o">.</span><span class="n">INCOME</span><span class="p">,</span> <span class="n">LEDGER_SUBTYPE</span><span class="o">.</span><span class="n">ACC_RECEIVABLE</span><span class="p">),</span>
    <span class="p">(</span><span class="n">LEDGER_TYPE</span><span class="o">.</span><span class="n">EXPENSE</span><span class="p">,</span> <span class="n">LEDGER_SUBTYPE</span><span class="o">.</span><span class="n">NA</span><span class="p">),</span>
    <span class="p">(</span><span class="n">LEDGER_TYPE</span><span class="o">.</span><span class="n">EQUITY</span><span class="p">,</span> <span class="n">LEDGER_SUBTYPE</span><span class="o">.</span><span class="n">NA</span><span class="p">),</span>
    <span class="p">])</span>


<span class="c"># ----------------------------------------------------------------------------</span>
<span class="c"># Helper functions</span>

<span class="k">def</span> <span class="nf">makeuuid</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>


<span class="c"># ----------------------------------------------------------------------------</span>
<span class="c"># Declarative tables</span>

<div class="viewcode-block" id="Ledger"><a class="viewcode-back" href="../../code/models.html#pennywise.models.Ledger">[docs]</a><span class="k">class</span> <span class="nc">Ledger</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ledger containing transactions with other ledgers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">&#39;ledger&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c">#: Location of ledger. Local or foreign</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mf">20</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;polymorphic_on&#39;</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="s">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s">&#39;local&#39;</span><span class="p">}</span>
    <span class="c">#: URL name of ledger. Must be site-unique and permanent</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mf">50</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="n">makeuuid</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c">#: Title of ledger</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mf">50</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c">#: User code for ledger</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mf">50</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c">#: Single-line description for ledger</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mf">250</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c">#: Longer text about this ledger</span>
    <span class="n">notes</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c">#: Placeholder ledgers can&#39;t contain transactions. They&#39;re meant</span>
    <span class="c">#: for holding a place in a hierarchy</span>
    <span class="n">placeholder</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c">#: Hidden ledgers are hidden in the UI.</span>
    <span class="n">hidden</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c">#: Ledger type</span>
    <span class="n">ltype</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="n">SmallInteger</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c">#: Ledger sub-type, if applicable. Affects UI</span>
    <span class="n">lsubtype</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s">&#39;subtype&#39;</span><span class="p">,</span> <span class="n">SmallInteger</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">LEDGER_SUBTYPE</span><span class="o">.</span><span class="n">NA</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c">#: Currency of ledger</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mf">3</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c">#: Ledger&#39;s parent, for nested ledgers</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;ledger.id&#39;</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c">#: SQLAlchemy mapper to access parent ledger object</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">relation</span><span class="p">(</span><span class="s">&#39;Ledger&#39;</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="n">parent_id</span><span class="p">,</span>
                      <span class="n">backref</span><span class="o">=</span><span class="n">backref</span><span class="p">(</span><span class="s">&#39;subledgers&#39;</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                                      <span class="n">cascade</span><span class="o">=</span><span class="s">&quot;all, delete-orphan&quot;</span><span class="p">))</span>
    <span class="c">#: Current balance in ledger</span>
    <span class="n">balance</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Numeric</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0</span><span class="p">)</span>

    <span class="n">query</span> <span class="o">=</span> <span class="n">DBSession</span><span class="o">.</span><span class="n">query_property</span><span class="p">(</span><span class="n">Query</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="c"># Balance on new ledgers is always zero</span>
        <span class="n">kw</span><span class="p">[</span><span class="s">&#39;balance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Ledger</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<div class="viewcode-block" id="Ledger.addSplitValue"><a class="viewcode-back" href="../../code/models.html#pennywise.models.Ledger.addSplitValue">[docs]</a>    <span class="k">def</span> <span class="nf">addSplitValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update ledger balance given a new split.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="n">split</span><span class="o">.</span><span class="n">value</span>
    </div>
<div class="viewcode-block" id="Ledger.delSplitValue"><a class="viewcode-back" href="../../code/models.html#pennywise.models.Ledger.delSplitValue">[docs]</a>    <span class="k">def</span> <span class="nf">delSplitValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update ledger balance for a split being removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">-=</span> <span class="n">split</span><span class="o">.</span><span class="n">value</span>

</div></div>
<div class="viewcode-block" id="ForeignLedger"><a class="viewcode-back" href="../../code/models.html#pennywise.models.ForeignLedger">[docs]</a><span class="k">class</span> <span class="nc">ForeignLedger</span><span class="p">(</span><span class="n">Ledger</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Placeholder for a remotely-hosted ledger. These ledgers are hidden by</span>
<span class="sd">    default and do not have a known balance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">&#39;foreignledger&#39;</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s">&#39;foreign&#39;</span><span class="p">}</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;ledger.id&#39;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c">#: Remote location of this ledger, as a valid URL</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mf">250</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">kw</span><span class="p">[</span><span class="s">&#39;hidden&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">kw</span><span class="p">[</span><span class="s">&#39;ltype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LEDGER_TYPE</span><span class="o">.</span><span class="n">USER</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ForeignLedger</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="UserLedger"><a class="viewcode-back" href="../../code/models.html#pennywise.models.UserLedger">[docs]</a><span class="k">class</span> <span class="nc">UserLedger</span><span class="p">(</span><span class="n">Ledger</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base ledger for all of a user&#39;s ledgers. Always a placeholder.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">&#39;userledger&#39;</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s">&#39;user&#39;</span><span class="p">}</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;ledger.id&#39;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">kw</span><span class="p">[</span><span class="s">&#39;placeholder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">UserLedger</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Transaction"><a class="viewcode-back" href="../../code/models.html#pennywise.models.Transaction">[docs]</a><span class="k">class</span> <span class="nc">Transaction</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transaction between ledgers. Not to be confused with database transactions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">&#39;transaction&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c">#: Transaction UUID as a 36-char string representation</span>
    <span class="n">uuid</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mf">36</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">makeuuid</span><span class="p">)</span>
    <span class="c">#: Transaction date and time in UTC timezone</span>
    <span class="n">datetime</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c">#: User-facing transaction id number</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mf">30</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="c">#: User description of transaction</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mf">250</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="c">#: This is a cross-currency transaction</span>
    <span class="n">crosscurrency</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c">#: Exchange rate for two-currency transactions. Mutually exclusive with</span>
    <span class="c">#: :attr:`exchangevalue`.</span>
    <span class="n">exchangerate</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Numeric</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c">#: Exchange value for two-currency transactions. Mutually exclusive with</span>
    <span class="c">#: :attr:`exchangerate&#39;.</span>
    <span class="n">exchangevalue</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Numeric</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">query</span> <span class="o">=</span> <span class="n">DBSession</span><span class="o">.</span><span class="n">query_property</span><span class="p">(</span><span class="n">Query</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TransactionSplit"><a class="viewcode-back" href="../../code/models.html#pennywise.models.TransactionSplit">[docs]</a><span class="k">class</span> <span class="nc">TransactionSplit</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transaction split, connecting a transaction to a ledger.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">&#39;transactionsplit&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c">#: Ledger that this split belongs to</span>
    <span class="n">ledger_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;ledger.id&#39;</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c">#: SQLAlchemy mapper to load ledger object</span>
    <span class="n">ledger</span> <span class="o">=</span> <span class="n">relation</span><span class="p">(</span><span class="n">Ledger</span><span class="p">,</span> <span class="n">primaryjoin</span><span class="o">=</span><span class="n">ledger_id</span> <span class="o">==</span> <span class="n">Ledger</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                      <span class="n">backref</span><span class="o">=</span><span class="n">backref</span><span class="p">(</span><span class="s">&#39;splits&#39;</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span>
                                      <span class="n">cascade</span><span class="o">=</span><span class="s">&#39;all, delete-orphan&#39;</span><span class="p">))</span>
    <span class="c">#: Transaction that this split belongs to</span>
    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;transaction.id&#39;</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c">#: SQLALchemy mapper to load transaction object</span>
    <span class="n">transaction</span> <span class="o">=</span> <span class="n">relation</span><span class="p">(</span><span class="n">Transaction</span><span class="p">,</span> <span class="n">primaryjoin</span><span class="o">=</span><span class="n">transaction_id</span> <span class="o">==</span> <span class="n">Transaction</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                           <span class="n">backref</span><span class="o">=</span><span class="n">backref</span><span class="p">(</span><span class="s">&#39;splits&#39;</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span>
                                           <span class="n">cascade</span><span class="o">=</span><span class="s">&#39;all, delete-orphan&#39;</span><span class="p">))</span>
    <span class="c">#: Has this transaction been reconciled within this ledger?</span>
    <span class="n">reconciled</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c">#: Value of transaction</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Numeric</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="n">query</span> <span class="o">=</span> <span class="n">DBSession</span><span class="o">.</span><span class="n">query_property</span><span class="p">(</span><span class="n">Query</span><span class="p">)</span>
</div>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;LEDGER_TYPE&#39;</span><span class="p">,</span> <span class="s">&#39;LEDGER_SUBTYPE&#39;</span><span class="p">,</span> <span class="s">&#39;LEDGER_TYPE_COMBOS&#39;</span><span class="p">,</span>
           <span class="s">&#39;Ledger&#39;</span><span class="p">,</span> <span class="s">&#39;ForeignLedger&#39;</span><span class="p">,</span> <span class="s">&#39;UserLedger&#39;</span><span class="p">,</span> <span class="s">&#39;Transaction&#39;</span><span class="p">,</span>
           <span class="s">&#39;TransactionSplit&#39;</span><span class="p">,</span>
           <span class="s">&#39;IntegrityError&#39;</span><span class="p">,</span> <span class="s">&#39;NoResultFound&#39;</span><span class="p">]</span>
</pre></div>

        <div style="clear: both"></div>
      </div>
      <div id="footer">
        Copyright © 2010 by <a href="http://jace.zaiki.in/">Kiran Jonnalagadda</a>.
        Documentation generated by <a href="http://sphinx.pocoo.org/">Sphinx</a>
        using the template from <a href="http://wtforms.simplecodes.com/">WTForms</a>.
      </div>
    </div>
  </body>
</html>